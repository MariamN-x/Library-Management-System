import java.util.List;
import javafx.event.ActionEvent;
import javafx.event.EventHandler;
import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.Scene;
import javafx.scene.control.Alert;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.control.PasswordField;
import javafx.scene.control.TextField;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.layout.FlowPane;
import javafx.scene.layout.HBox;
import javafx.scene.layout.StackPane;
import javafx.scene.layout.VBox;
import javafx.stage.Stage;

public class ButtonHandler  extends FirstPage implements EventHandler<ActionEvent> {

    
    
    
    //login constructor without retypePasswordField
    public ButtonHandler(List<User> users, Stage primaryStage, TextField usernameField, PasswordField passwordField, Button login, Button signup) {
        super.users = users;
        super.primaryStage = primaryStage;
        super.usernameField = usernameField;
        super.passwordField = passwordField;
        super.login = login;
        super.signup1 = signup;
    }
    //signup constructor
    public ButtonHandler(List<User> users, Stage primaryStage, TextField usernameField, PasswordField passwordField,PasswordField retypePasswordField, Button login, Button signup) {
        super.users = users;
        super.primaryStage = primaryStage;
        super.usernameField = usernameField;
        super.passwordField = passwordField;
        super.retypePasswordField =retypePasswordField;
        super.login = login;
        super.signup2 = signup;
    }
       
    
    @Override
    public void handle(ActionEvent event) {
        if (event.getSource() == login) 
            handleLogin();
        else if (event.getSource() == signup1) 
            handleSignUp1();       
        else if(event.getSource()==signup2)
            handleSignUp2();
            
    }

    private void handleLogin() {
        String username = usernameField.getText();
        String password = passwordField.getText();

        if (Login(username, password, primaryStage)) {
            showAlert("Login Successful!", Alert.AlertType.INFORMATION);
        } else {
            showAlert("Invalid username or password!", Alert.AlertType.ERROR);
        }
    
  }

    private void handleSignUp1() {
        String username = usernameField.getText();
        String password = passwordField.getText();
        primaryStage.setScene(signUpScene());     
    }
     private void handleSignUp2() {
        String username = usernameField.getText();
        String password = passwordField.getText();

        if (signup(username, password, primaryStage)) { 
          if (isAdminSignupAllowed(username)) 
            primaryStage.setScene(AdminScene());
          else if (isLibrarianSignupAllowed(username)) 
            primaryStage.setScene(LibrarianScene());
          else 
            primaryStage.setScene(BorrowerScene());
    
        }
         else {
            showAlert("Signup Failed!", Alert.AlertType.ERROR);
        }

    }
    
     // scene handling
     
        
    
private Scene signUpScene() {
    Image image = new Image("file:ELib.png");
    ImageView imageView = new ImageView(image);

    Label usernameLbl1 = new Label("Username  ");
    usernameField = new TextField();
    // remove borders except bottom
    usernameField.setStyle("-fx-background-color: transparent; -fx-background-radius: 0; -fx-border-width: 0 0 1 0; -fx-border-color: black;");

    Label passwordLbl = new Label("Password  ");
    passwordField = new PasswordField();
    passwordField.setStyle("-fx-background-color: transparent; -fx-background-radius: 0; -fx-border-width: 0 0 1 0; -fx-border-color: black;");

    Label reTypepasswordLbl = new Label("Re-Type Password");
    retypePasswordField = new PasswordField();
    retypePasswordField.setStyle("-fx-background-color: transparent; -fx-background-radius: 0; -fx-border-width: 0 0 1 0; -fx-border-color: black;");

    signup2 = new Button("Sign Up");
    signup2.setStyle("-fx-font-size: 15px; -fx-background-color: #062758; -fx-text-fill: white;");

    FlowPane root1 = new FlowPane(usernameLbl1, usernameField);
    root1.setAlignment(Pos.CENTER);
    root1.setHgap(10);
    root1.setVgap(5);
    root1.setPadding(new Insets(0, 0, 0, 200));

    FlowPane root2 = new FlowPane(passwordLbl, passwordField);
    root2.setAlignment(Pos.CENTER);
    root2.setHgap(10);
    root2.setVgap(5);
    root2.setPadding(new Insets(0, 0, 0, 200));

    FlowPane root3 = new FlowPane(reTypepasswordLbl, retypePasswordField);
    root3.setAlignment(Pos.CENTER);
    root3.setHgap(10);
    root3.setVgap(5);
    root3.setPadding(new Insets(0, 0, 0, 200));

    FlowPane root4 = new FlowPane( signup2);
    root4.setAlignment(Pos.CENTER);
    root4.setHgap(20);
    root4.setPadding(new Insets(20, 0, 0, 250));

    VBox Root = new VBox();
    Root.setAlignment(Pos.CENTER);
    Root.setSpacing(10);
    Root.getChildren().addAll(root1, root2, root3, root4);

    Label lbl3 = new Label("Library\n\t\tManagment\n\t\t\t\t\tSystem");
    lbl3.setStyle("-fx-font-size: 21px; -fx-font-weight: bold; -fx-font-family: 'Georgia';-fx-font-style: italic; -fx-text-fill: white;");
    HBox lastRoot = new HBox(lbl3);
    lastRoot.setAlignment(Pos.CENTER_LEFT);
    lastRoot.setPadding(new Insets(0, 0, 0, 20));

    StackPane all = new StackPane(imageView, Root, lastRoot);
    Scene scene = new Scene(all, 700, 600);

    ButtonHandler buttonHandler = new ButtonHandler(users, primaryStage, usernameField, passwordField, retypePasswordField, login, signup2);
    signup2.setOnAction(buttonHandler);

    return scene;
}


 

private void showAlert(String message, Alert.AlertType alertType) {
        Alert alert = new Alert(alertType);
        alert.setTitle("Message");
        alert.setHeaderText(null);
        alert.setContentText(message);
        alert.showAndWait();
    }
}
